#!/usr/lib/plan9/bin/rc

# Copyright (C) 2009 Andy Spencer
# See ../COPYING for terms

fn usage {
	echo 'usage: '$0' <action> [start-|stop-]<service>'
	echo 'Action:'
	echo '  -u,--is-up    Test is service is running'
	echo '  -d,--is-down  Test is service is stopped'
	echo '  -U,--set-up   Set service to running'
	echo '  -D,--set-down Set service to stopped'
	echo '  -q,--query    Print the state of a service'
	exit
}

# Main
STATE=/lib/mkinit/state

action=$1
service=`{echo $2 | sed s/-.*//}

if(~ $action '' || ~ $service '')
	usage

switch($1){
case -u --is-up
	test   -e $STATE/$service
case -d --is-down
	test ! -e $STATE/$service
case -U --set-up
	touch     $STATE/$service
case -D --set-down
	rm        $STATE/$service
case -q --query
	echo -n Service "$service" is
	test -e $STATE/$service \
		&& echo ' running' \
		|| echo ' stopped'
case *
	usage
}
